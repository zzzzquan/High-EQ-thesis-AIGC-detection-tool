<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaperPass 权威论文抄袭检测系统</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/iframe.css">
</head>
<body>
<div id="m-content" class="both">
    <div id="m-primary">
        <iframe src="standard_report.html?type=both" name="left" id="check_report"></iframe>
    </div>
    <div id="m-secondary">
        <iframe src="standard_report_ai.html?type=both" name="right" id="ai_report"></iframe>
    </div>
</div>

<div class="modal" id="dialog">
    <div class="modal-dialog">
        <iframe src="sentence_detail.html?type=both" id="sentence_detail"></iframe>
    </div>
</div>

<div class="modal" id="dialogAi">
    <div class="modal-dialog">
        <iframe src="sentence_detail_ai.html?type=both" id="sentence_detail_ai"></iframe>
    </div>
</div>

<script src="js/jquery.min.js"></script>
<script src="js/lib.js"></script>
<script src="js/detaildata.js"></script>
<script src="js/util.js"></script>
<script>
    const iframe = document.getElementById('check_report');
    const iframeRight = document.getElementById('ai_report');
    const sentenceDetail = document.getElementById('sentence_detail');
    const sentenceDetailAI = document.getElementById('sentence_detail_ai');
    const isHasDoubleRowWord = typeof is_has_double_row_word == "boolean" ? is_has_double_row_word : false;

    (function(System, $) {
        'use strict';
        ReportID = ReportID + `_both`;
        System.operateState.saveId(ReportID);

        let initPage = System.operateState.getInitPage(ReportID);
        let isHasLinkage = System.operateState.getLinkageState(ReportID);

        if (!isHasDoubleRowWord || initPage == "switch_text") {
            iframe.src = "text_report.html?type=both";
            iframeRight.src = "text_report_ai.html?type=both";
        } else {
            iframe.src = "standard_report.html?type=both";
            iframeRight.src = "standard_report_ai.html?type=both";
        }

        isHasLinkage = isHasLinkage === '' ? true : isHasLinkage;

        if (isHasLinkage) {
            $(".modal").addClass("linkage");
        } else {
            $(".modal").removeClass("linkage");
        }
    })(Report, jQuery);

    $("#dialog").click(function() {
        sentenceDetail.contentWindow.postMessage('closeModal', '*');
    });

    $("#dialogAi").click(function() {
        sentenceDetailAI.contentWindow.postMessage('closeModal', '*');
    });

    window.addEventListener("message", function ({ data }) {
        if (data.checkAxis) {
            iframeRight.contentWindow.postMessage(data, '*');
        } else if (data.aiAxis) {
            iframe.contentWindow.postMessage(data, '*');
        } else {
            iframe.contentWindow.postMessage(data, '*');
            iframeRight.contentWindow.postMessage(data, '*');
        }
        if (data == "word_right" || data == "text_right") {
            sentenceDetail.contentWindow.postMessage(data, '*');
            sentenceDetailAI.contentWindow.postMessage(data, '*');
            if (data == "word_right") {
                iframe.src = "text_report.html?type=both";
                iframeRight.src = "text_report_ai.html?type=both";
            }
            if (data == "text_right") {
                iframe.src = "standard_report.html?type=both";
                iframeRight.src = "standard_report_ai.html?type=both";
            }
        }
        if (typeof data.isHasLinkage == "boolean") {
            isHasLinkage = data.isHasLinkage;
            if (isHasLinkage) {
                $(".modal").addClass("linkage");
            } else {
                $(".modal").removeClass("linkage");
            }
        }
        if (data.isDetailReport) {
            sentenceDetail.contentWindow.postMessage(data, '*');
            $("#dialog").css("display", "grid");
        }
        if (data.isAIReport) {
            sentenceDetailAI.contentWindow.postMessage(data, '*');
            $("#dialogAi").css("display", "grid");
        }
        if (data.closeModal == 'closeDetail' || data == 'clickReduceNavBtn') {
            $("#dialog").css("display", "none");
        }
        if (data.closeModal == 'closeAigc' || data == 'clickReduceAiNavBtn') {
            $("#dialogAi").css("display", "none");
        }
    }, false);
</script>
</body>
</html>